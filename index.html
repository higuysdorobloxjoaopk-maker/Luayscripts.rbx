<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Luay</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  <style>
    * { font-family: 'Poppins', sans-serif; }
    body {
      background: linear-gradient(135deg, #0a0612 0%, #1a1126 50%, #0f0815 100%);
      color: #e0e0e0;
    }
    .glass-card {
      background: linear-gradient(135deg, rgba(88, 28, 135, 0.3), rgba(139, 92, 246, 0.2));
      border: 1px solid rgba(168, 85, 247, 0.2);
      backdrop-filter: blur(10px);
    }
    .input-field {
      background: rgba(15, 8, 21, 0.6);
      border: 1px solid rgba(168, 85, 247, 0.2);
      border-radius: 8px;
      padding: 12px 16px;
      color: #e0e0e0;
    }
    .input-field:focus {
      outline: none;
      border-color: #a855f7;
      box-shadow: 0 0 12px rgba(168, 85, 247, 0.2);
    }
    pre {
      white-space: pre-wrap;
      word-break: break-word;
    }
  </style>
</head>

<body class="min-h-screen flex flex-col">

<header class="glass-card border-b border-purple-500/20 sticky top-0 z-30 px-4 py-4">
  <div class="max-w-6xl mx-auto">
    <h1 class="text-2xl font-bold text-center mb-4">⚡ Luay</h1>

    <div class="relative">
      <svg class="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-purple-400"
           fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 0 0114 0z"/>
      </svg>
      <input
        id="search-input"
        type="text"
        placeholder="Buscar scripts ou \\criador..."
        class="input-field w-full pl-10"
      />
    </div>
  </div>
</header>

<main class="flex-1 max-w-6xl mx-auto px-4 py-6">
  <div id="scripts-feed" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
</main>

<div id="detail-modal" class="fixed inset-0 bg-black/60 hidden items-center justify-center z-50">
  <div class="bg-gradient-to-b from-purple-900 via-purple-950 to-purple-950 rounded-2xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto relative">
    <button onclick="closeDetail()" class="absolute top-4 right-4 text-purple-300 hover:text-white">✖</button>
    <div id="detail-content"></div>
  </div>
</div>

<script>
let scripts = [];

async function loadScripts() {
  const res = await fetch("scripts.json?_=" + Date.now());
  scripts = await res.json();
  renderScripts();
}

function renderScripts() {
  const feed = document.getElementById("scripts-feed");
  const q = document.getElementById("search-input").value.toLowerCase();

  let filtered = scripts;

  if (q.startsWith("\\")) {
    const creator = q.slice(1);
    filtered = scripts.filter(s =>
      s.creator_name.toLowerCase().includes(creator)
    );
  } else if (q) {
    filtered = scripts.filter(s =>
      s.title.toLowerCase().includes(q)
    );
  }

  feed.innerHTML = filtered.map(script => `
    <div class="glass-card rounded-xl overflow-hidden cursor-pointer transition-all hover:-translate-y-1 hover:shadow-xl"
         onclick="openDetail('${script.id}')">
      ${script.banner ? `<img src="${script.banner}" class="w-full h-40 object-cover">` : ""}
      <div class="p-4 space-y-2">
        <h2 class="text-lg font-bold">${escape(script.title)}</h2>
        <p class="text-sm text-gray-300 line-clamp-2">${escape(script.description)}</p>

        <div class="flex items-center gap-2 mt-3">
          <img src="${script.creator_avatar}" class="w-8 h-8 rounded-full">
          <a href="https://discord.com/users/${script.creator_id}"
             target="_blank"
             onclick="event.stopPropagation()"
             class="text-sm font-semibold hover:text-purple-300">
             ${escape(script.creator_name)}
          </a>
        </div>
      </div>
    </div>
  `).join("");
}

function openDetail(id) {
  const script = scripts.find(s => s.id === id);
  if (!script) return;

  const modal = document.getElementById("detail-modal");
  const content = document.getElementById("detail-content");

  content.innerHTML = `
    ${script.banner ? `<img src="${script.banner}" class="w-full h-52 object-cover rounded-t-2xl">` : ""}

    <div class="p-6 space-y-4">
      <h2 class="text-2xl font-bold">${escape(script.title)}</h2>
      <p class="text-gray-300">${escape(script.description)}</p>

      <div class="flex items-center gap-2">
        <img src="${script.creator_avatar}" class="w-9 h-9 rounded-full">
        <a href="https://discord.com/users/${script.creator_id}"
           target="_blank"
           class="font-semibold hover:text-purple-300">
           ${escape(script.creator_name)}
        </a>
      </div>

      <pre class="bg-black/40 border border-purple-500/20 rounded-lg p-4 overflow-x-auto text-sm text-purple-200">${escape(script.code)}</pre>

      <div class="flex gap-3">
        <button onclick="copyCode('${encodeURIComponent(script.code)}')"
                class="px-4 py-2 rounded-lg bg-purple-600 hover:bg-purple-700 font-semibold">
          Copiar
        </button>
        <button onclick="downloadCode('${encodeURIComponent(script.code)}','${escape(script.title)}')"
                class="px-4 py-2 rounded-lg bg-purple-600 hover:bg-purple-700 font-semibold">
          Baixar
        </button>
      </div>

      <div class="border-t border-purple-500/20 pt-4">
        <h3 class="font-bold mb-2">Comentários</h3>
        <div id="comments-${script.id}" class="space-y-3 mb-3"></div>

        <div class="flex gap-2">
          <input id="comment-input-${script.id}" class="input-field flex-1" placeholder="Digite seu comentário...">
          <button onclick="postComment('${script.id}')"
                  class="px-4 py-2 rounded-lg bg-purple-600 hover:bg-purple-700 font-bold">
            &gt;
          </button>
        </div>
      </div>
    </div>
  `;

  loadComments(script.id);
  modal.classList.remove("hidden");
  modal.classList.add("flex");
}

function closeDetail() {
  const modal = document.getElementById("detail-modal");
  modal.classList.add("hidden");
  modal.classList.remove("flex");
}

function loadComments(scriptId) {
  const key = "comments_" + scriptId;
  const comments = JSON.parse(localStorage.getItem(key) || "[]");

  const box = document.getElementById(`comments-${scriptId}`);
  box.innerHTML = comments.map(c => `
    <div class="bg-purple-900/30 border border-purple-500/20 rounded-lg p-3">
      <div class="flex items-center gap-2 mb-1">
        <img src="${c.avatar}" class="w-6 h-6 rounded-full">
        <span class="font-semibold text-sm">${escape(c.name)}</span>
      </div>
      <p class="text-sm text-gray-300">${escape(c.text)}</p>
    </div>
  `).join("");
}

function postComment(scriptId) {
  const input = document.getElementById(`comment-input-${scriptId}`);
  const text = input.value.trim();
  if (!text) return;

  const key = "comments_" + scriptId;
  const comments = JSON.parse(localStorage.getItem(key) || "[]");

  comments.push({
    name: "Anônimo",
    avatar: "https://cdn.discordapp.com/embed/avatars/0.png",
    text
  });

  localStorage.setItem(key, JSON.stringify(comments));
  input.value = "";
  loadComments(scriptId);
}

function copyCode(code) {
  navigator.clipboard.writeText(decodeURIComponent(code));
  alert("Código copiado!");
}

function downloadCode(code, name) {
  const link = document.createElement("a");
  link.href = "data:text/plain;charset=utf-8," + decodeURIComponent(code);
  link.download = name + ".txt";
  link.click();
}

function escape(str) {
  return str.replace(/[&<>"']/g, m => ({
    "&": "&amp;",
    "<": "&lt;",
    ">": "&gt;",
    '"': "&quot;",
    "'": "&#039;"
  })[m]);
}

document.getElementById("search-input").addEventListener("input", renderScripts);
loadScripts();
</script>

</body>
  </html>
