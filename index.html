<!doctype html>
<html lang="pt-BR" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Luay Scripts Premium</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&amp;family=JetBrains+Mono:wght@400;600&amp;display=swap" rel="stylesheet">
  <style>
    * {
      font-family: 'Poppins', sans-serif;
      box-sizing: border-box;
    }

    html, body {
      height: 100%;
      width: 100%;
      margin: 0;
      padding: 0;
      overflow-x: hidden;
    }

    body {
      background: linear-gradient(135deg, #0a0612 0%, #1a1126 50%, #0f0815 100%);
      color: #e0e0e0;
    }

    ::-webkit-scrollbar {
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: rgba(200, 100, 255, 0.05);
    }

    ::-webkit-scrollbar-thumb {
      background: #8b5cf6;
      border-radius: 4px;
    }

    .glass-card {
      background: linear-gradient(135deg, rgba(88, 28, 135, 0.3) 0%, rgba(139, 92, 246, 0.2) 50%, rgba(168, 85, 247, 0.15) 100%);
      border: 1px solid rgba(168, 85, 247, 0.2);
      backdrop-filter: blur(10px);
    }

    .gradient-btn {
      background: linear-gradient(135deg, #8b5cf6 0%, #a855f7 50%, #d8b4fe 100%);
      color: white;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .gradient-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(139, 92, 246, 0.3);
    }

    .gradient-btn:active {
      transform: translateY(0);
    }

    .gradient-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .input-field {
      background: rgba(15, 8, 21, 0.6);
      border: 1px solid rgba(168, 85, 247, 0.2);
      border-radius: 8px;
      padding: 12px 16px;
      color: #e0e0e0;
      transition: all 0.3s ease;
    }

    .input-field:focus {
      outline: none;
      border-color: #a855f7;
      box-shadow: 0 0 12px rgba(168, 85, 247, 0.2);
    }

    .input-field::placeholder {
      color: rgba(224, 224, 224, 0.3);
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .animate-in {
      animation: slideIn 0.3s ease;
    }

    .modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 50;
      display: none;
      align-items: center;
      justify-content: center;
    }

    .modal.show {
      display: flex;
      animation: fadeIn 0.2s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .avatar-sm {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: linear-gradient(135deg, #8b5cf6, #a855f7);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      color: white;
      font-size: 16px;
      overflow: hidden;
      flex-shrink: 0;
    }

    .avatar-lg {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      background: linear-gradient(135deg, #8b5cf6, #a855f7);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      color: white;
      font-size: 40px;
      overflow: hidden;
    }

    .avatar-sm img, .avatar-lg img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .script-card {
      background: linear-gradient(135deg, rgba(88, 28, 135, 0.2) 0%, rgba(139, 92, 246, 0.15) 100%);
      border: 1px solid rgba(168, 85, 247, 0.15);
      border-radius: 12px;
      overflow: hidden;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .script-card:hover {
      transform: translateY(-4px);
      border-color: rgba(168, 85, 247, 0.4);
      box-shadow: 0 12px 32px rgba(139, 92, 246, 0.2);
    }

    .icon-btn {
      background: rgba(168, 85, 247, 0.1);
      border: 1px solid rgba(168, 85, 247, 0.2);
      border-radius: 8px;
      padding: 8px;
      color: #c4b5fd;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .icon-btn:hover {
      background: rgba(168, 85, 247, 0.2);
    }

    .toast {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(139, 92, 246, 0.9);
      color: white;
      padding: 12px 24px;
      border-radius: 8px;
      font-weight: 600;
      z-index: 60;
      animation: slideIn 0.3s ease;
    }

    .spinner {
      border: 3px solid rgba(168, 85, 247, 0.1);
      border-top: 3px solid #a855f7;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .banner-preview {
      width: 100%;
      height: 200px;
      border-radius: 8px;
      background: rgba(15, 8, 21, 0.6);
      border: 1px solid rgba(168, 85, 247, 0.2);
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #999;
    }

    .banner-preview img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .comment-item {
      background: rgba(88, 28, 135, 0.15);
      border: 1px solid rgba(168, 85, 247, 0.1);
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 12px;
    }

    .comment-item:hover {
      border-color: rgba(168, 85, 247, 0.3);
    }

    .code-block {
      background: #0a0612;
      border: 1px solid rgba(168, 85, 247, 0.2);
      border-radius: 8px;
      padding: 16px;
      overflow-x: auto;
      font-family: 'JetBrains Mono', monospace;
      font-size: 13px;
      color: #d8b4fe;
      line-height: 1.5;
    }

    .banner-img {
      width: 100%;
      height: 250px;
      object-fit: cover;
      border-radius: 12px 12px 0 0;
    }

    .gsi-btn {
      width: 100%;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="h-full w-full flex flex-col"><!-- Header -->
  <header class="glass-card border-b border-purple-500/20 sticky top-0 z-30 px-4 py-4">
   <div class="max-w-6xl mx-auto">
    <div class="flex items-center justify-between mb-4">
     <div class="flex-1"></div>
     <h1 id="app-title" class="text-2xl font-bold text-center flex-1">‚ö° Luay</h1>
     <div class="flex-1 flex justify-end gap-2">
      <div id="google-login-container"></div><button id="post-script-btn" class="gradient-btn px-4 py-2 rounded-lg font-semibold text-sm whitespace-nowrap hidden"> Postar Script </button> <button id="profile-btn" class="icon-btn p-2 hidden" title="Perfil">
       <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
       </svg></button>
     </div>
    </div>
    <div class="relative">
     <svg class="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-purple-400" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
     </svg><input type="text" id="search-input" placeholder="Buscar scripts..." class="input-field w-full pl-10">
    </div>
   </div>
  </header><!-- Main Content -->
  <main id="main-content" class="flex-1 overflow-y-auto">
   <div class="max-w-6xl mx-auto px-4 py-6">
    <div id="scripts-feed" class="space-y-4 pb-20">
    </div>
    <div id="empty-state" class="hidden text-center py-20">
     <div class="text-6xl mb-4">
      üìú
     </div>
     <h2 class="text-2xl font-bold text-gray-300 mb-2">Nenhum script encontrado</h2>
     <p class="text-gray-400">Compartilhe seu primeiro script!</p>
    </div>
   </div>
  </main><!-- Profile Modal -->
  <div id="profile-modal" class="modal">
   <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" onclick="closeProfile()"></div>
   <div class="relative bg-gradient-to-b from-purple-900 via-purple-950 to-purple-950 rounded-2xl max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto">
    <div class="sticky top-0 glass-card border-b border-purple-500/20 p-4 flex items-center justify-between">
     <h2 class="font-bold text-lg">Meu Perfil</h2><button onclick="closeProfile()" class="icon-btn p-2">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg></button>
    </div>
    <div class="p-6 space-y-6">
     <div class="text-center">
      <div id="profile-avatar" class="avatar-lg mx-auto mb-4">
       A
      </div>
      <h3 id="profile-name" class="text-xl font-bold">Username</h3>
      <p id="profile-email" class="text-purple-300 text-sm">email@example.com</p><textarea id="profile-bio" class="input-field w-full mt-4 resize-none" rows="3" placeholder="Sua bio aqui..."></textarea> <button id="save-bio-btn" class="gradient-btn w-full mt-3 py-2 rounded-lg font-semibold" onclick="saveBio()"> Salvar Bio </button>
     </div>
     <div class="grid grid-cols-2 gap-4">
      <div class="glass-card p-4 rounded-lg text-center">
       <div id="profile-followers" class="text-2xl font-bold text-purple-300">
        0
       </div>
       <div class="text-sm text-gray-400">
        Seguidores
       </div>
      </div>
      <div class="glass-card p-4 rounded-lg text-center">
       <div id="profile-following" class="text-2xl font-bold text-purple-300">
        0
       </div>
       <div class="text-sm text-gray-400">
        Seguindo
       </div>
      </div>
     </div>
     <div>
      <h4 class="font-bold text-lg mb-3">Meus Scripts</h4>
      <div id="my-scripts-list" class="space-y-2">
      </div>
     </div><button id="logout-btn" class="w-full bg-red-500/20 border border-red-500/40 text-red-400 font-semibold py-3 rounded-lg hover:bg-red-500/30 transition-colors" onclick="logout()"> Sair da Conta </button>
    </div>
   </div>
  </div><!-- New Script Modal -->
  <div id="new-script-modal" class="modal">
   <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" onclick="closeNewScript()"></div>
   <div class="relative bg-gradient-to-b from-purple-900 via-purple-950 to-purple-950 rounded-2xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
    <div class="sticky top-0 glass-card border-b border-purple-500/20 p-4 flex items-center justify-between">
     <h2 class="font-bold text-lg">Novo Script</h2><button onclick="closeNewScript()" class="icon-btn p-2">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg></button>
    </div>
    <form id="script-form" class="p-6 space-y-4" onsubmit="submitScript(event)">
     <div><label class="text-sm font-semibold text-purple-300 block mb-2">Nome do Script *</label> <input type="text" id="script-name" class="input-field w-full" placeholder="Ex: Auto Farm Ultra" required>
     </div>
     <div><label class="text-sm font-semibold text-purple-300 block mb-2">Descri√ß√£o *</label> <textarea id="script-desc" class="input-field w-full" placeholder="Descreva o que o script faz..." rows="3" required></textarea>
     </div>
     <div><label class="text-sm font-semibold text-purple-300 block mb-2">URL do Banner (opcional)</label> <input type="url" id="script-banner" class="input-field w-full" placeholder="https://imgur.com/image.jpg">
      <div id="banner-preview" class="banner-preview mt-2"><span class="text-gray-500">Pr√©via do banner</span>
      </div>
     </div>
     <div><label class="text-sm font-semibold text-purple-300 block mb-2">C√≥digo do Script *</label> <textarea id="script-code" class="input-field w-full font-mono text-sm" placeholder="Cola o c√≥digo aqui..." rows="6" required></textarea>
     </div>
     <div class="flex gap-3"><button type="button" onclick="closeNewScript()" class="flex-1 bg-purple-900/50 border border-purple-500/30 text-purple-300 font-semibold py-3 rounded-lg hover:bg-purple-900 transition-colors"> Cancelar </button> <button type="submit" id="submit-script-btn" class="flex-1 gradient-btn py-3 rounded-lg font-semibold"> Postar Script </button>
     </div>
    </form>
   </div>
  </div><!-- Script Detail Modal -->
  <div id="detail-modal" class="modal">
   <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" onclick="closeDetail()"></div>
   <div id="detail-content" class="relative bg-gradient-to-b from-purple-900 via-purple-950 to-purple-950 rounded-2xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
   </div>
  </div><!-- Toast -->
  <div id="toast" class="hidden toast"></div>
  <script>
    const defaultConfig = {
      app_title: 'Luay',
      create_btn_text: 'Criar Conta',
      post_btn_text: 'Postar Script'
    };

    let config = { ...defaultConfig };
    let currentUser = null;
    let allScripts = [];
    let allUsers = [];
    let allComments = [];

    const dataHandler = {
      onDataChanged(data) {
        allScripts = data.filter(d => d.type === 'script');
        allUsers = data.filter(d => d.type === 'user');
        allComments = data.filter(d => d.type === 'comment');
        renderScripts();
      }
    };

    async function init() {
      if (window.elementSdk) {
        window.elementSdk.init({
          defaultConfig,
          onConfigChange: async (newConfig) => {
            config = { ...defaultConfig, ...newConfig };
            applyConfig();
          },
          mapToCapabilities: () => ({
            recolorables: [],
            borderables: [],
            fontEditable: undefined,
            fontSizeable: undefined
          }),
          mapToEditPanelValues: (cfg) => new Map([
            ['app_title', cfg.app_title || defaultConfig.app_title],
            ['create_btn_text', cfg.create_btn_text || defaultConfig.create_btn_text],
            ['post_btn_text', cfg.post_btn_text || defaultConfig.post_btn_text]
          ])
        });
      }

      if (window.dataSdk) {
        await window.dataSdk.init(dataHandler);
      }

      applyConfig();
      setupEventListeners();
      initGoogleSignIn();
      checkLogin();
    }

    function applyConfig() {
      document.getElementById('app-title').textContent = '‚ö° ' + (config.app_title || defaultConfig.app_title);
    }

    function setupEventListeners() {
      document.getElementById('post-script-btn').addEventListener('click', openNewScript);
      document.getElementById('profile-btn').addEventListener('click', openProfile);
      document.getElementById('search-input').addEventListener('input', filterScripts);
      document.getElementById('script-banner').addEventListener('change', updateBannerPreview);
    }

    function initGoogleSignIn() {
    window.google.accounts.id.initialize({
        client_id: '844922830132-ce9t0racuihl8jfpglmgnuciifq1liof.apps.googleusercontent.com',
        callback: handleCredentialResponse
    });

    window.google.accounts.id.renderButton(
        document.getElementById('google-login-container'),
        { theme: 'outline', size: 'medium', width: '200', text: 'signin' }
    )
     
    window.google.accounts.id.prompt();
    }

      window.google.accounts.id.renderButton(
        document.getElementById('google-login-container'),
        {
          theme: 'outline',
          size: 'medium',
          width: '200',
          text: 'signin'
        }
      );
    }

    async function handleCredentialResponse(response) {
      const token = response.credential;
      const base64Url = token.split('.')[1];
      const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
      const jsonPayload = decodeURIComponent(
        atob(base64)
          .split('')
          .map((c) => '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2))
          .join('')
      );
      const data = JSON.parse(jsonPayload);

      const existingUser = allUsers.find(u => u.email === data.email);

      if (existingUser) {
        currentUser = existingUser;
      } else {
        const newUser = {
          type: 'user',
          user_id: 'user_' + Date.now(),
          username: data.name,
          email: data.email,
          avatar: data.picture || '',
          bio: '',
          followers: 0,
          following: 0,
          provider: 'google',
          created_at: new Date().toISOString()
        };

        await window.dataSdk.create(newUser);
        currentUser = newUser;
      }

      localStorage.setItem('luay_user', JSON.stringify(currentUser));
      showUserMode();
    }

    function checkLogin() {
      const saved = localStorage.getItem('luay_user');
      if (saved) {
        try {
          currentUser = JSON.parse(saved);
          const stillExists = allUsers.find(u => u.user_id === currentUser.user_id);
          if (stillExists) {
            currentUser = stillExists;
            showUserMode();
          }
        } catch {
          localStorage.removeItem('luay_user');
        }
      }
    }

    function showUserMode() {
      document.getElementById('google-login-container').style.display = 'none';
      document.getElementById('post-script-btn').classList.remove('hidden');
      document.getElementById('profile-btn').classList.remove('hidden');
      updateProfileUI();
      renderScripts();
    }

    function openNewScript() {
      document.getElementById('new-script-modal').classList.add('show');
    }

    function closeNewScript() {
      document.getElementById('new-script-modal').classList.remove('show');
      document.getElementById('script-form').reset();
      document.getElementById('banner-preview').innerHTML = '<span class="text-gray-500">Pr√©via do banner</span>';
    }

    function updateBannerPreview() {
      const url = document.getElementById('script-banner').value;
      const preview = document.getElementById('banner-preview');

      if (url) {
        const img = document.createElement('img');
        img.src = url;
        img.onerror = () => {
          preview.innerHTML = '<span class="text-red-400">Erro ao carregar imagem</span>';
        };
        preview.innerHTML = '';
        preview.appendChild(img);
      } else {
        preview.innerHTML = '<span class="text-gray-500">Pr√©via do banner</span>';
      }
    }

    async function submitScript(e) {
      e.preventDefault();

      if (!currentUser) {
        showToast('Fa√ßa login primeiro!');
        return;
      }

      if (allScripts.length >= 999) {
        showToast('Limite de scripts atingido');
        return;
      }

      const btn = document.getElementById('submit-script-btn');
      btn.disabled = true;
      btn.innerHTML = '<div class="spinner mx-auto"></div>';

      const scriptData = {
        type: 'script',
        script_id: 'script_' + Date.now(),
        script_name: document.getElementById('script-name').value.trim(),
        description: document.getElementById('script-desc').value.trim(),
        code: document.getElementById('script-code').value.trim(),
        banner_url: document.getElementById('script-banner').value.trim(),
        author_id: currentUser.user_id,
        created_at: new Date().toISOString(),
        downloads: 0,
        likes: 0,
        comments_count: 0
      };

      const result = await window.dataSdk.create(scriptData);
      if (result.isOk) {
        showToast('Script postado com sucesso!');
        closeNewScript();
      } else {
        showToast('Erro ao postar script');
      }

      btn.disabled = false;
      btn.textContent = 'Postar Script';
    }

    function renderScripts() {
      const feed = document.getElementById('scripts-feed');
      const empty = document.getElementById('empty-state');
      const search = document.getElementById('search-input').value.toLowerCase();

      const filtered = allScripts
        .filter(s =>
          s.script_name.toLowerCase().includes(search) ||
          s.description.toLowerCase().includes(search)
        )
        .sort((a, b) => new Date(b.created_at) - new Date(a.created_at));

      if (filtered.length === 0) {
        feed.innerHTML = '';
        empty.classList.remove('hidden');
        return;
      }

      empty.classList.add('hidden');
      feed.innerHTML = filtered
        .map(script => createScriptCard(script))
        .join('');
    }

    function createScriptCard(script) {
      const author = allUsers.find(u => u.user_id === script.author_id);
      const authorName = author ? escapeHtml(author.username) : 'Desconhecido';
      const avatarText = author ? author.username.charAt(0).toUpperCase() : 'U';
      const scriptComments = allComments.filter(c => c.comment_author_id === script.__backendId);

      return `
        <div class="script-card animate-in" onclick="viewScriptDetail('${script.__backendId}')">
          ${
            script.banner_url
              ? `<img src="${escapeHtml(script.banner_url)}" alt="Banner" class="banner-img" loading="lazy" onerror="this.style.display='none'">`
              : ''
          }
          <div class="p-4">
            <div class="flex items-start gap-3 mb-3">
              <div class="avatar-sm">
                ${author?.avatar ? `<img src="${escapeHtml(author.avatar)}" alt="${authorName}">` : avatarText}
              </div>
              <div class="flex-1 min-w-0">
                <h3 class="font-bold truncate">${authorName}</h3>
                <p class="text-gray-400 text-xs">${formatDate(script.created_at)}</p>
              </div>
            </div>

            <h4 class="font-bold mb-2 text-lg">${escapeHtml(script.script_name)}</h4>
            <p class="text-gray-300 text-sm mb-3 line-clamp-2">${escapeHtml(script.description)}</p>

            <div class="bg-black/30 rounded-lg p-3 mb-4 max-h-24 overflow-y-auto">
              <pre class="font-mono text-xs text-purple-300 whitespace-pre-wrap break-words">${escapeHtml(script.code.substring(0, 150))}${script.code.length > 150 ? '...' : ''}</pre>
            </div>

            <div class="flex gap-3 text-sm">
              <button onclick="likeScript(event, '${script.__backendId}')" class="flex items-center gap-1 hover:text-purple-300 transition-colors">
                <span>‚ù§Ô∏è</span>
                <span>${script.likes || 0}</span>
              </button>
              <button onclick="event.stopPropagation()" class="flex items-center gap-1 hover:text-purple-300 transition-colors">
                <span>üí¨</span>
                <span>${script.comments_count || 0}</span>
              </button>
              <button onclick="downloadScript(event, '${script.__backendId}', '${escapeHtml(script.script_name)}')" class="flex items-center gap-1 hover:text-purple-300 transition-colors">
                <span>‚¨áÔ∏è</span>
                <span>${script.downloads || 0}</span>
              </button>
              <button onclick="copyCode(event, '${escapeHtml(script.code).replace(/'/g, "\\'")}')" class="flex items-center gap-1 hover:text-purple-300 transition-colors">
                <span>üìã</span>
              </button>
            </div>
          </div>
        </div>
      `;
    }

    function filterScripts() {
      renderScripts();
    }

    function viewScriptDetail(id) {
      const script = allScripts.find(s => s.__backendId === id);
      const author = allUsers.find(u => u.user_id === script.author_id);
      const avatarText = author ? author.username.charAt(0).toUpperCase() : 'U';
      const authorName = author ? escapeHtml(author.username) : 'Desconhecido';
      const scriptComments = allComments.filter(c => c.comment_author_id === script.__backendId);

      const modal = document.getElementById('detail-modal');
      const content = document.getElementById('detail-content');

      let commentsHtml = scriptComments
        .map(comment => {
          const commentAuthor = allUsers.find(u => u.user_id === comment.comment_author_id);
          const commentAuthorName = commentAuthor ? escapeHtml(commentAuthor.username) : 'An√¥nimo';
          const commentAuthorAvatar = commentAuthor ? commentAuthor.username.charAt(0).toUpperCase() : 'A';

          return `
            <div class="comment-item">
              <div class="flex items-start gap-2 mb-2">
                <div class="avatar-sm text-xs">${commentAuthorAvatar}</div>
                <div class="flex-1 min-w-0">
                  <p class="font-bold text-sm">${commentAuthorName}</p>
                  <p class="text-gray-400 text-xs">${formatDate(comment.comment_date)}</p>
                </div>
              </div>
              <p class="text-sm text-gray-300">${escapeHtml(comment.comment_text)}</p>
            </div>
          `;
        })
        .join('');

      content.innerHTML = `
        <div class="sticky top-0 glass-card border-b border-purple-500/20 p-4 flex items-center justify-between">
          <h2 class="font-bold text-lg">Detalhes</h2>
          <button onclick="closeDetail()" class="icon-btn p-2">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>

        <div class="p-6 space-y-4">
          ${
            script.banner_url
              ? `<img src="${escapeHtml(script.banner_url)}" alt="Banner" class="w-full h-48 object-cover rounded-lg" loading="lazy" onerror="this.style.display='none'">`
              : ''
          }

          <div>
            <h3 class="text-2xl font-bold mb-2">${escapeHtml(script.script_name)}</h3>
            <p class="text-gray-300 text-sm mb-4">${escapeHtml(script.description)}</p>
          </div>

          <div class="glass-card p-4 rounded-lg flex items-center gap-3">
            <div class="avatar-sm">
              ${author?.avatar ? `<img src="${escapeHtml(author.avatar)}" alt="${authorName}">` : avatarText}
            </div>
            <div>
              <p class="font-bold">${authorName}</p>
              <p class="text-gray-400 text-xs">${formatDate(script.created_at)}</p>
            </div>
          </div>

          <div class="code-block">${escapeHtml(script.code)}</div>

          <div class="flex gap-2">
            <button onclick="copyCode(null, '${escapeHtml(script.code).replace(/'/g, "\\'")}')" class="gradient-btn flex-1 py-2 rounded-lg font-semibold text-sm">
              üìã Copiar
            </button>
            <button onclick="downloadScript(null, '${script.__backendId}', '${escapeHtml(script.script_name)}')" class="gradient-btn flex-1 py-2 rounded-lg font-semibold text-sm">
              ‚¨áÔ∏è Baixar
            </button>
          </div>

          <div class="flex gap-4 text-sm">
            <button onclick="likeScript(null, '${script.__backendId}')" class="flex items-center gap-1 hover:text-purple-300 transition-colors">
              ‚ù§Ô∏è <span id="like-count-${script.__backendId}">${script.likes || 0}</span>
            </button>
            <div class="flex items-center gap-1">
              üí¨ <span>${script.comments_count || 0}</span>
            </div>
            <div class="flex items-center gap-1">
              ‚¨áÔ∏è <span id="download-count-${script.__backendId}">${script.downloads || 0}</span>
            </div>
          </div>

          <div class="border-t border-purple-500/20 pt-4">
            <h4 class="font-bold mb-3">Coment√°rios</h4>
            <div class="space-y-3 mb-4 max-h-48 overflow-y-auto">
              ${commentsHtml || '<p class="text-gray-400 text-sm">Nenhum coment√°rio ainda</p>'}
            </div>

            ${
              currentUser
                ? `
            <div class="flex gap-2">
              <input type="text" id="comment-input-${script.__backendId}" class="input-field flex-1" placeholder="Adicione um coment√°rio...">
              <button onclick="postComment('${script.__backendId}')" class="gradient-btn px-4 py-2 rounded-lg font-semibold">
                ‚Üí
              </button>
            </div>
            `
                : '<p class="text-gray-400 text-sm">Fa√ßa login para comentar</p>'
            }
          </div>
        </div>
      `;

      modal.classList.add('show');
    }

    function closeDetail() {
      document.getElementById('detail-modal').classList.remove('show');
    }

    async function postComment(scriptId) {
      if (!currentUser) {
        showToast('Fa√ßa login para comentar!');
        return;
      }

      const inputId = `comment-input-${scriptId}`;
      const input = document.getElementById(inputId);
      if (!input) return;

      const text = input.value.trim();
      if (!text) return;

      const script = allScripts.find(s => s.__backendId === scriptId);
      if (!script) return;

      const updated = {
        ...script,
        comments_count: (script.comments_count || 0) + 1
      };

      await window.dataSdk.update(updated);

      const commentData = {
        type: 'comment',
        comment_id: 'comment_' + Date.now(),
        comment_text: text,
        comment_author_id: currentUser.user_id,
        comment_date: new Date().toISOString(),
        comment_author_id: scriptId
      };

      await window.dataSdk.create(commentData);
      input.value = '';
      showToast('Coment√°rio adicionado!');

      setTimeout(() => {
        viewScriptDetail(scriptId);
      }, 500);
    }

    async function likeScript(e, id) {
      if (e) {
        e.stopPropagation();
      }

      const script = allScripts.find(s => s.__backendId === id);
      if (!script) return;

      const updated = { ...script, likes: (script.likes || 0) + 1 };
      await window.dataSdk.update(updated);
    }

    async function downloadScript(e, id, name) {
      if (e) {
        e.stopPropagation();
      }

      const script = allScripts.find(s => s.__backendId === id);
      if (!script) return;

      const updated = { ...script, downloads: (script.downloads || 0) + 1 };
      await window.dataSdk.update(updated);

      const link = document.createElement('a');
      link.href = 'data:text/plain;charset=utf-8,' + encodeURIComponent(script.code);
      link.download = name + '.txt';
      link.click();

      showToast('Script baixado!');
    }

    function copyCode(e, code) {
      if (e) {
        e.stopPropagation();
      }

      navigator.clipboard.writeText(code).then(() => {
        showToast('C√≥digo copiado para a √°rea de transfer√™ncia!');
      });
    }

    function openProfile() {
      document.getElementById('profile-modal').classList.add('show');
      updateProfileUI();
    }

    function closeProfile() {
      document.getElementById('profile-modal').classList.remove('show');
    }

    function updateProfileUI() {
      if (!currentUser) return;

      const initial = currentUser.username ? currentUser.username.charAt(0).toUpperCase() : 'A';
      const profileAvatar = document.getElementById('profile-avatar');

      if (currentUser.avatar) {
        profileAvatar.innerHTML = `<img src="${escapeHtml(currentUser.avatar)}" alt="${currentUser.username}">`;
      } else {
        profileAvatar.textContent = initial;
      }

      document.getElementById('profile-name').textContent = currentUser.username;
      document.getElementById('profile-email').textContent = currentUser.email;
      document.getElementById('profile-bio').value = currentUser.bio || '';
      document.getElementById('profile-followers').textContent = currentUser.followers || 0;
      document.getElementById('profile-following').textContent = currentUser.following || 0;

      const myScripts = allScripts.filter(s => s.author_id === currentUser.user_id);
      const scriptsList = document.getElementById('my-scripts-list');

      if (myScripts.length === 0) {
        scriptsList.innerHTML = '<p class="text-gray-400 text-sm">Nenhum script postado</p>';
      } else {
        scriptsList.innerHTML = myScripts
          .map(
            s => `
          <div class="script-card p-3 cursor-pointer" onclick="viewScriptDetail('${s.__backendId}')">
            <h5 class="font-bold truncate">${escapeHtml(s.script_name)}</h5>
            <p class="text-gray-400 text-xs">${formatDate(s.created_at)}</p>
          </div>
        `
          )
          .join('');
      }
    }

    async function saveBio() {
      if (!currentUser) return;

      const bio = document.getElementById('profile-bio').value.trim();
      const btn = document.getElementById('save-bio-btn');

      btn.disabled = true;
      btn.textContent = 'Salvando...';

      const updated = { ...currentUser, bio };
      const result = await window.dataSdk.update(updated);

      if (result.isOk) {
        currentUser.bio = bio;
        localStorage.setItem('luay_user', JSON.stringify(currentUser));
        showToast('Bio atualizada!');
      } else {
        showToast('Erro ao salvar');
      }

      btn.disabled = false;
      btn.textContent = 'Salvar Bio';
    }

    function logout() {
      currentUser = null;
      localStorage.removeItem('luay_user');
      closeProfile();
      document.getElementById('google-login-container').style.display = 'block';
      document.getElementById('post-script-btn').classList.add('hidden');
      document.getElementById('profile-btn').classList.add('hidden');
      renderScripts();
      showToast('Desconectado com sucesso!');
    }

    function escapeHtml(str) {
      if (!str) return '';
      const div = document.createElement('div');
      div.textContent = str;
      return div.innerHTML;
    }

    function formatDate(date) {
      if (!date) return 'Agora';
      return new Date(date).toLocaleDateString('pt-BR', { month: 'short', day: 'numeric' });
    }

    function showToast(msg) {
      const toast = document.getElementById('toast');
      toast.textContent = msg;
      toast.classList.remove('hidden');
      setTimeout(() => toast.classList.add('hidden'), 2500);
    }

    init();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9cb7c2d690faf1b4',t:'MTc3MDY4NjE4Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
